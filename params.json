{"name":"My Little App","tagline":"Easy setup of your own Heroku clone with Ansible and Dokku","body":"Introduction\r\n------------\r\n\r\nThis is an [Ansible](https://github.com/ansible/ansible) playbook that from scratch will automatically turn a pristine server into your own Heroku clone. All you need is the server, a domain name, and a DNS service supporting alias records. Everything is powered by [Dokku](https://github.com/progrium/dokku), which itself runs on [Docker](https://www.docker.io/).\r\n\r\n\r\nSetup\r\n-----\r\n\r\n([See bottom section if you are feeling adventurous.](#my-little-crazy-one-shot-auto-setup))\r\n\r\nJust follow these instructions, and you will soon be up and running:\r\n\r\n1. **Register a domain name** where your applications will live, for example `mylittleapp.org`. Each application will run on a subdomain of this host, e.g. `helloworld.mylittleapp.org`.\r\n\r\n2. **Set up a new server** that you can access by SSH key only. This playbook has been tested on a new Ubuntu 13.04 droplet on [DigitalOcean](https://www.digitalocean.com/), but a variety of other setups should work as well.\r\n\r\n3. **Set up two DNS entries** for the new domain name, both pointing at the new server's IP address:\r\n * One `A` record for `mylittleapp.org`\r\n * One `A` record for `*.mylittleapp.org`\r\n\r\n    Your DNS provider must support alias A records of some kind. The above example works on [Amazon Route 53](http://aws.amazon.com/route53/), but something like [DNSimple](https://dnsimple.com/) should work as well.\r\n\r\n4. Make sure your new domain name points at the name servers of your DNS service.\r\n\r\n5. [Install Ansible](http://docs.ansible.com/intro_installation.html) and its dependencies on your local machine.\r\n\r\n6. Clone this repository to your local machine: `git clone https://github.com/alimony/mylittleapp.git`\r\n\r\n7. Copy the file `hosts.template` to `hosts` and change \"mylittleapp.org\" to your own domain name.\r\n\r\n8. Copy your public SSH key to the `authorized_keys` directory (e.g. `cp ~/.ssh/id_dsa.pub authorized_keys/mykey.pub`)\r\n\r\n9. **Everything should be ready now!** Sit back, relax, and run: `ansible-playbook site.yml -v`\r\n\r\n\r\nDeploying applications\r\n----------------------\r\n\r\nTo deploy an application to your new server, you just have to add a remote to an existing git repository and push to it. Starting with an empty directory, it can look something like this:\r\n\r\n```bash\r\ngit init\r\necho '<?php echo \"Hello my little app!\" ?>' > index.php\r\ngit add .\r\ngit commit -m 'Initial commit.'\r\ngit remote add deploy dokku@mylittleapp.org:helloworld\r\ngit push deploy master\r\n```\r\n\r\nThere will now be application deployment magic happening, much like you're used to from Heroku. The application type is auto-detected and everything needed to run it will be installed (inside a Docker container) and launched. To visit your new application, just go to `<appname>.mylittleapp.org`. (In the example above that would be `helloworld.mylittleapp.org`.)\r\n\r\nAll subdomains that are not pointing at an application will redirect to the main hostname. If you want to run an application at the main hostname, create one with just your domain name as its name:\r\n\r\n```bash\r\ngit init\r\nmkdir www\r\necho 'My little home' > www/index.html\r\ntouch .nginx\r\ngit add .\r\ngit commit -m 'Initial commit.'\r\ngit remote add deploy dokku@mylittleapp.org:mylittleapp.org\r\ngit push deploy master\r\n```\r\n\r\nTouching the `.nginx` file is how the [nginx buildpack](https://github.com/rhy-jot/buildpack-nginx) detects it's a static application. All the actual files for the site should live in the `www` directory.\r\n\r\n### Important\r\n\r\nYou should really set up an application at the main hostname, or it will be in a redirection loop.\r\n\r\n\r\nAdditional notes\r\n----------------\r\n\r\n* To give more users access to the setup, just add their public SSH to key the `authorized_keys` directory and run the playbook again.\r\n* By default, Dokku will be fetched from the `HEAD` of its `master` branch. If you want to use another branch, or a specific tag or commit, just change the `dokku_version=HEAD` part in `hosts`, for example `dokku_version=v0.2.2`.\r\n* For maximum encapsulation, you might want to install and run Ansible itself from a [virtual environment](http://virtualenvwrapper.readthedocs.org/). Just `cd` into your Ansible directory and run `pip install -e .` to install all its dependencies.\r\n\r\n\r\nImprovements\r\n------------\r\nThe purpose of this deliberately simple setup is to get you up and running as easy as possible. Only what should be useful to most people is included, which will continue to be the criteria for any changes. With that said, there is of course room for much improvement. If you have ideas, please [open an issue](https://github.com/alimony/mylittleapp/issues) about it, or open a pull request directly if you have code to contribute.\r\n\r\n\r\nDisclaimer\r\n----------\r\nThis is my first public Ansible playbook ever. Much of it is probably written in a sub-optimal way, since I have yet to learn all the ins and outs of how to organize playbooks, roles, etc. If you have useful input, let me know. I will happily learn and adjust. I can't guarantee that this playbook will not hurt your server, so please only run it on a fresh one, or one that you do not care for :)\r\n\r\n\r\nCredits\r\n-------\r\nMy Little App is merely a piece of glue. The heavy lifting is carried out by [Ansible](http://www.ansible.com/home), [Dokku](https://github.com/progrium/dokku) and [Docker](https://www.docker.io/), as well as all other parts of great open source software running today's internet infrastructure. If you like this project, please check out the others, and try to help out where you can. Thank you!\r\n\r\n---\r\n\r\n### My Little Crazy One Shot Auto Setupâ„¢\r\n\r\nIf you are feeling adventurous, there is experimental work on creating a server and setting up DNS records as part of the playbook. This means you can go from nothing to a fully working Heroku clone with one single command. Currently, only DigitalOcean and Amazon Route 53 is supported. To try this out, make sure you meet these requirements:\r\n\r\n * You have a new domain name with its name servers pointed at a hosted zone in Amazon Route 53.\r\n * You have your API credentials for both DigitalOcean and Amazon Web Services handy.\r\n * For DigitalOcean you will need the python package `dopy` and for Route 53 you need `boto`.\r\n\r\nThis is how to proceed:\r\n\r\n 1. Clone this repository to your local machine: `git clone https://github.com/alimony/mylittleapp.git`\r\n 2. Copy `mylittleapp.org.template` to `mylittleapp.org` in `host_vars` and edit as needed, uncommenting the `server_provider` and `dns_provider` lines. Be sure to fill in all `do_` and `aws_` setting values.\r\n 3. Copy `hosts.template` to `hosts` and change it to your own domain name.\r\n 4. Copy your public SSH key to the `authorized_keys` directory: `cp ~/.ssh/id_dsa.pub authorized_keys/mykey.pub`\r\n 5. Run the playbook and enjoy the ride: `ansible-playbook site.yml -v`\r\n\r\nHopefully, the end result will be the same as before, with with far less work. Note that this feature is highly experimental and needs a lot more testing to be considered stable.\r\n","google":"UA-48816942-1","note":"Don't delete this file! It's used internally to help with page regeneration."}